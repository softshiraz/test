<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پخش فیلم</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #fff; 
            font-family: Tahoma, sans-serif; 
            text-align: center;
        }
        #videoContainer { 
            width: 100vw; 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative;
        }
        video { 
            max-width: 100%; 
            max-height: 100%; 
        }
        #passwordOverlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        #passwordOverlay input { 
            padding: 10px; 
            font-size: 18px; 
            margin-bottom: 20px; 
            width: 200px;
        }
        #passwordOverlay button { 
            padding: 10px 20px; 
            font-size: 18px; 
            cursor: pointer;
        }
        #adminControls { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(0,0,0,0.7); 
            padding: 10px; 
            border-radius: 8px; 
            display: none;
            z-index: 10;
        }
        #loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            color: yellow; 
            font-size: 24px; 
            display: none; 
            z-index: 10;
        }
        /* مخفی کردن کامل کنترل‌ها و جلوگیری از تعامل کاربر عادی */
        video::-webkit-media-controls { display: none !important; }
        video::-webkit-media-controls-panel { display: none !important; }
        video::-webkit-media-controls-play-button { display: none !important; }
        video::-webkit-media-controls-timeline { display: none !important; }
        video::-webkit-media-controls-current-time-display { display: none !important; }
        video::-webkit-media-controls-time-remaining-display { display: none !important; }
        video::-webkit-media-controls-volume-slider { display: none !important; }
        video::-webkit-media-controls-fullscreen-button { display: none !important; }
    </style>
</head>
<body>

    <div id="passwordOverlay">
        <h2>برای ورود رمز عبور را وارد کنید</h2>
        <input type="password" id="passwordInput" placeholder="رمز عبور">
        <button onclick="checkPassword()">ورود</button>
        <p id="errorMsg" style="color:red; display:none;">رمز عبور اشتباه است!</p>
    </div>

    <div id="videoContainer">
        <video id="video" playsinline autoplay></video>
        <div id="loading">در حال بارگذاری فیلم...</div>
    </div>

    <div id="adminControls">
        <h3>کنترل رهبر (رمز 1111)</h3>
        <p>لینک فیلم مستقیماً در این کد (خط videoUrl) تغییر داده شود و صفحه را دوباره آپلود کنید.</p>
        <button onclick="reloadVideo()">به‌روزرسانی فیلم</button>
    </div>

    <script>
        const USER_PASSWORD = "1234";   // رمز کاربر عادی
        const ADMIN_PASSWORD = "1111";  // رمز رهبر

        let isAdmin = false;

        // <<<--- لینک فیلم را دقیقاً اینجا تغییر بده (فقط این خط را ویرایش کن و فایل را دوباره در GitHub آپلود کن)
        let videoUrl = "https://s1.dlserfes.info/dl6/2022/Top.Gun.Maverick.2022/Top.Gun.Maverick.2022.720p.BluRay.Dubbed.FilmKio.mkv?md5=QrowAG4GcVBaXqoq9UI32A&u=288589&expires=1766117902";

        const PROXY_URL = "https://videochat.softshiraz.workers.dev/stream"; 
        // لینک ثابت Cloudflare Worker که لینک مستقیم را پروکسی می‌کند

        function checkPassword() {
            const input = document.getElementById("passwordInput").value;
            const errorMsg = document.getElementById("errorMsg");

            if (input === USER_PASSWORD) {
                isAdmin = false;
                startPlayback();
            } else if (input === ADMIN_PASSWORD) {
                isAdmin = true;
                startPlayback();
                document.getElementById("adminControls").style.display = "block";
            } else {
                errorMsg.style.display = "block";
            }
        }

        function startPlayback() {
            document.getElementById("passwordOverlay").style.display = "none";
            document.getElementById("loading").style.display = "block";

            const video = document.getElementById("video");

            // برای کاربر عادی: هیچ کنترلی، هیچ seek، حتی pause/play غیرفعال
            if (!isAdmin) {
                video.controls = false;
                video.style.pointerEvents = "none"; // هیچ کلیک یا تعاملی
            } else {
                video.controls = true; // رهبر همه کنترل‌ها را داشته باشد
            }

            // پخش مستقیم از طریق پروکسی Cloudflare
            video.src = PROXY_URL;
            video.play().catch(e => console.error("خطای پخش:", e));

            video.addEventListener("canplay", () => {
                document.getElementById("loading").style.display = "none";
            });

            // پشتیبانی زیرنویس و دوبله: مرورگر به‌طور خودکار trackهای داخلی MKV را نشان می‌دهد
            // (اگر controls فعال باشد، کاربر می‌تواند انتخاب کند؛ برای کاربر عادی مخفی است اما track پیش‌فرض کار می‌کند)
        }

        function reloadVideo() {
            if (!isAdmin) return;
            location.reload(); // صفحه را ریلود می‌کند تا لینک جدید (اگر تغییر داده باشی) اعمال شود
        }

        // جلوگیری اضافی از seek برای کاربر عادی (در صورت فعال شدن کنترل‌ها)
        const video = document.getElementById("video");
        let supposedCurrentTime = 0;
        video.addEventListener("timeupdate", function() {
            if (!video.seeking && !isAdmin) {
                supposedCurrentTime = video.currentTime;
            }
        });
        video.addEventListener("seeking", function() {
            if (!isAdmin) {
                video.currentTime = supposedCurrentTime;
            }
        });
    </script>

</body>
</html>
