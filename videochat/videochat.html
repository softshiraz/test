<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پخش زنده فیلم</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #fff; 
            font-family: Tahoma, sans-serif; 
            text-align: center;
        }
        #videoContainer { 
            width: 100vw; 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        video { 
            max-width: 100%; 
            max-height: 100%; 
        }
        #passwordOverlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        #passwordOverlay input { 
            padding: 10px; 
            font-size: 18px; 
            margin-bottom: 20px; 
            width: 200px;
        }
        #passwordOverlay button { 
            padding: 10px 20px; 
            font-size: 18px; 
            cursor: pointer;
        }
        #adminControls { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(0,0,0,0.7); 
            padding: 10px; 
            border-radius: 8px; 
            display: none;
        }
        #adminControls input { 
            width: 80%; 
            padding: 8px; 
            margin-bottom: 10px;
        }
        #adminControls button { 
            padding: 8px 16px; 
        }
    </style>
</head>
<body>

    <div id="passwordOverlay">
        <h2>برای ورود رمز عبور را وارد کنید</h2>
        <input type="password" id="passwordInput" placeholder="رمز عبور">
        <button onclick="checkPassword()">ورود</button>
        <p id="errorMsg" style="color:red; display:none;">رمز عبور اشتباه است!</p>
    </div>

    <div id="videoContainer">
        <video id="video" controls autoplay playsinline></video>
    </div>

    <div id="adminControls">
        <h3>کنترل رهبر (فقط برای تغییر لینک)</h3>
        <input type="text" id="hlsUrlInput" placeholder="لینک m3u8 پخش زنده را وارد کنید">
        <button onclick="updateStream()">به‌روزرسانی پخش</button>
    </div>

    <script>
        const USER_PASSWORD = "1234";   // رمز کاربر عادی
        const ADMIN_PASSWORD = "1111";  // رمز رهبر (برای تغییر لینک)

        let isAdmin = false;
        let currentHlsUrl = "";  // لینک اولیه خالی - رهبر باید وارد کند

        function checkPassword() {
            const input = document.getElementById("passwordInput").value;
            const errorMsg = document.getElementById("errorMsg");

            if (input === USER_PASSWORD) {
                isAdmin = false;
                hideOverlayAndStart();
            } else if (input === ADMIN_PASSWORD) {
                isAdmin = true;
                hideOverlayAndStart();
                document.getElementById("adminControls").style.display = "block";
            } else {
                errorMsg.style.display = "block";
            }
        }

        function hideOverlayAndStart() {
            document.getElementById("passwordOverlay").style.display = "none";
            initPlayer();
        }

        let hls;

        function initPlayer() {
            const video = document.getElementById("video");

            // غیرفعال کردن کنترل‌های seek (جلو/عقب) برای کاربر عادی
            if (!isAdmin) {
                video.controls = true; // کنترل‌ها نمایش داده شوند اما seek غیرفعال
                video.onloadedmetadata = () => {
                    video.controlsList = "nodownload"; // اختیاری: غیرفعال کردن دانلود
                };
                // مخفی کردن progress bar با CSS
                video.style.setProperty('--seek-disabled', 'none');
            } else {
                video.controls = true;
            }

            if (currentHlsUrl && Hls.isSupported()) {
                hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 0  // برای لایو واقعی، بافر عقب کم
                });
                hls.loadSource(currentHlsUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    video.play();
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // پشتیبانی native در Safari
                video.src = currentHlsUrl;
                video.play();
            }
        }

        function updateStream() {
            if (!isAdmin) return;

            const newUrl = document.getElementById("hlsUrlInput").value.trim();
            if (newUrl && newUrl.endsWith('.m3u8')) {
                currentHlsUrl = newUrl;

                if (hls) {
                    hls.destroy();
                }
                initPlayer();
                alert("لینک پخش به‌روزرسانی شد!");
            } else {
                alert("لینک معتبر m3u8 وارد کنید!");
            }
        }

        // CSS برای غیرفعال کردن seek در مرورگرهای مختلف (برای کاربر عادی)
        const style = document.createElement('style');
        style.innerHTML = `
            video::-webkit-media-controls-timeline { display: none !important; }
            video::-webkit-media-controls-current-time-display { display: none !important; }
            video::-webkit-media-controls-time-remaining-display { display: none !important; }
            /* برای Firefox و دیگران */
            video { pointer-events: ${isAdmin ? 'auto' : 'none'}; } /* کاربر نتواند کلیک کند */
        `;
        document.head.appendChild(style);
    </script>

</body>
</html>
