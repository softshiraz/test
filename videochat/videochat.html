<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙ…Ø§Ø´Ø§ÛŒ Ù…Ø´ØªØ±Ú©</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#0e0e0f;color:#fff;font-family:sans-serif}
video{width:100%;border-radius:12px;border:2px solid gold}
.chat{background:#111;padding:10px;border-radius:10px}
.msg{background:#222;margin:6px;padding:6px;border-radius:6px}
button,input{padding:8px;border-radius:6px}
#login{position:fixed;inset:0;background:#000d;display:flex;align-items:center;justify-content:center}
</style>
</head>

<body>

<div id="login">
  <div>
    <h3>ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø§ØªØ§Ù‚</h3>
    <input id="code" placeholder="Ú©Ø¯ ÙˆØ±ÙˆØ¯">
    <button onclick="auth()">ÙˆØ±ÙˆØ¯</button>
  </div>
</div>

<h2>ğŸ¬ ØªÙ…Ø§Ø´Ø§ÛŒ Ù…Ø´ØªØ±Ú©</h2>

<video id="video" controls>
  <source src="https://s1.dlserfes.info/dl6/2022/Top.Gun.Maverick.2022/Top.Gun.Maverick.2022.720p.BluRay.Dubbed.FilmKio.mkv?md5=QrowAG4GcVBaXqoq9UI32A&u=288589&expires=1766117902">
</video>

<div>
<button onclick="play()">â–¶ï¸</button>
<button onclick="pause()">â¸</button>
</div>

<div class="chat">
  <div id="chat"></div>
  <input id="msg" placeholder="Ù¾ÛŒØ§Ù…..." onkeydown="if(event.key==='Enter')send()">
</div>

<script>
const room = new URLSearchParams(location.search).get("room") || "public";
const ws = new WebSocket("wss://videochat.softshiraz.workers.dev/" + room);
const video = document.getElementById("video");
let isLeader = false;

ws.onmessage = e => {
  const d = JSON.parse(e.data);

  if (d.t === "auth") {
    if (!d.ok) return alert("âŒ Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");
    login.style.display="none";
    isLeader = d.leader;

    d.messages.forEach(add);
    video.currentTime = d.time;
    if (d.playing) video.play();
  }

  if (d.t === "chat") add(d.m);
  if (d.t === "play") { video.currentTime=d.time; video.play(); }
  if (d.t === "pause") { video.currentTime=d.time; video.pause(); }
};

function auth(){
  ws.send(JSON.stringify({t:"auth",code:code.value}));
}

function send(){
  ws.send(JSON.stringify({t:"chat",m:msg.value}));
  msg.value="";
}
function add(t){
  const d=document.createElement("div");
  d.className="msg"; d.textContent=t;
  chat.appendChild(d);
}

function play(){
  if(!isLeader) return;
  ws.send(JSON.stringify({t:"play",time:video.currentTime}));
}
function pause(){
  if(!isLeader) return;
  ws.send(JSON.stringify({t:"pause",time:video.currentTime}));
}
</script>
</body>
</html>
