<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پخش فیلم</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            color: #fff; 
            font-family: Tahoma, sans-serif; 
            text-align: center;
        }
        #videoContainer { 
            width: 100vw; 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            position: relative;
        }
        video { 
            max-width: 100%; 
            max-height: 100%; 
        }
        #passwordOverlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
        }
        #passwordOverlay input { 
            padding: 10px; 
            font-size: 18px; 
            margin-bottom: 20px; 
            width: 200px;
        }
        #passwordOverlay button { 
            padding: 10px 20px; 
            font-size: 18px; 
            cursor: pointer;
        }
        #adminControls { 
            position: absolute; 
            bottom: 20px; 
            left: 50%; 
            transform: translateX(-50%); 
            background: rgba(0,0,0,0.7); 
            padding: 10px; 
            border-radius: 8px; 
            display: none;
            z-index: 10;
        }
        #loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            color: yellow; 
            font-size: 24px; 
            display: none; 
            z-index: 10;
        }
        #error { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            color: red; 
            font-size: 24px; 
            display: none; 
            z-index: 10;
        }
        /* مخفی کردن کامل کنترل‌ها و جلوگیری از تعامل کاربر عادی */
        video::-webkit-media-controls { display: none !important; }
        video::-webkit-media-controls-panel { display: none !important; }
        video::-webkit-media-controls-play-button { display: none !important; }
        video::-webkit-media-controls-timeline { display: none !important; }
        video::-webkit-media-controls-current-time-display { display: none !important; }
        video::-webkit-media-controls-time-remaining-display { display: none !important; }
        video::-webkit-media-controls-volume-slider { display: none !important; }
        video::-webkit-media-controls-fullscreen-button { display: none !important; }
    </style>
</head>
<body>

    <div id="passwordOverlay">
        <h2>برای ورود رمز عبور را وارد کنید</h2>
        <input type="password" id="passwordInput" placeholder="رمز عبور">
        <button onclick="checkPassword()">ورود</button>
        <p id="errorMsg" style="color:red; display:none;">رمز عبور اشتباه است!</p>
    </div>

    <div id="videoContainer">
        <video id="video" playsinline autoplay muted></video>
        <div id="loading">در حال بارگذاری فیلم... (ممکن است چند ثانیه طول بکشد)</div>
        <div id="error">خطا در پخش فیلم! لینک نامعتبر یا expire شده.</div>
    </div>

    <div id="adminControls">
        <h3>کنترل رهبر (رمز 1111)</h3>
        <p>لینک جدید را در این کد (خط videoUrl) بگذارید و فایل را دوباره در GitHub آپلود کنید.</p>
        <button onclick="reloadVideo()">به‌روزرسانی فیلم</button>
    </div>

    <script>
        const USER_PASSWORD = "1234";   // رمز کاربر عادی
        const ADMIN_PASSWORD = "1111";  // رمز رهبر

        let isAdmin = false;

        // <<<--- لینک فیلم مستقیم جدید را دقیقاً اینجا بگذار (یک لینک مستقیم MKV/MP4 معتبر و بدون expire)
        // مثال فعلی یک لینک تست نمونه (تریلر فیلم) است تا پخش کار کند. لینک قبلی expire شده بود.
        let videoUrl = "https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_10mb.mp4";
        // برای فیلم Top Gun Maverick دوبله فارسی، یک لینک مستقیم معتبر پیدا کن (از سایت‌های دانلود ایرانی مثل 30nama یا vgdl.ir) و اینجا بگذار.
        // اگر لینک expire داشت، دوباره عوض کن.

        const PROXY_URL = "https://videochat.softshiraz.workers.dev/stream"; 
        // لینک ثابت Cloudflare Worker

        function checkPassword() {
            const input = document.getElementById("passwordInput").value;
            const errorMsg = document.getElementById("errorMsg");

            if (input === USER_PASSWORD) {
                isAdmin = false;
                startPlayback();
            } else if (input === ADMIN_PASSWORD) {
                isAdmin = true;
                startPlayback();
                document.getElementById("adminControls").style.display = "block";
            } else {
                errorMsg.style.display = "block";
            }
        }

        function startPlayback() {
            document.getElementById("passwordOverlay").style.display = "none";
            document.getElementById("loading").style.display = "block";
            document.getElementById("error").style.display = "none";

            const video = document.getElementById("video");

            if (!isAdmin) {
                video.controls = false;
                video.style.pointerEvents = "none"; // هیچ تعاملی
            } else {
                video.controls = true;
            }

            // پخش از طریق پروکسی
            video.src = PROXY_URL;
            video.play().then(() => {
                document.getElementById("loading").style.display = "none";
            }).catch(e => {
                document.getElementById("loading").style.display = "none";
                document.getElementById("error").style.display = "block";
                console.error("خطای پخش:", e);
            });

            // جلوگیری اضافی از seek برای کاربر عادی
            let supposedCurrentTime = 0;
            video.addEventListener("timeupdate", function() {
                if (!video.seeking && !isAdmin) {
                    supposedCurrentTime = video.currentTime;
                }
            });
            video.addEventListener("seeking", function() {
                if (!isAdmin) {
                    video.currentTime = supposedCurrentTime;
                }
            });
        }

        function reloadVideo() {
            if (!isAdmin) return;
            location.reload();
        }
    </script>

</body>
</html>
