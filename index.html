<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0">

<!-- متا تگ‌های Open Graph (گزینه 36) -->
<meta property="og:title" content="سافت شیراز - اکران‌های خصوصی و ایونت‌های طلایی">
<meta property="og:description" content="اکران‌های خصوصی فیلم، کتابخوانی و ایونت‌های خاص در شیراز">
<meta property="og:image" content="https://yourusername.github.io/your-repo/images/og-image.jpg">
<meta property="og:url" content="https://yourusername.github.io/your-repo/">
<meta property="og:type" content="website">

<!-- Structured Data JSON-LD (گزینه 37) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "سافت شیراز",
  "url": "https://yourusername.github.io/your-repo/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "{search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<title>سافت شیراز</title>
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css?v=3" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css?v=3">

<!-- PWA Manifest (گزینه 34) -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffd700">

<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body {
    font-family: "Vazirmatn", sans-serif;
    background:#0e0e0f;
    color:#fff;
    overflow-x:hidden;
    position:relative;
}
/* Parallax Background (گزینه 42) */
body::before {
    content:''; position:fixed; top:0; left:0; width:100%; height:100%; z-index:-2;
    background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #0e0e0f 100%);
}
#particles-canvas { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }

/* هدر + دکمه‌های جدید */
header {
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
    padding:15px 25px;
    display:flex; justify-content:space-between; align-items:center;
    border-bottom:1px solid rgba(48,48,48,0.5);
    position:sticky; top:0; z-index:20;
}
.controls {
    display:flex; gap:12px; align-items:center;
}
.control-btn {
    background:rgba(26,26,26,0.6); border:2px solid rgba(255,215,0,0.25);
    color:#ffd700; width:42px; height:42px; border-radius:10px;
    display:flex; align-items:center; justify-content:center; cursor:pointer;
    transition:0.3s;
}
.control-btn.active, .control-btn:hover { background:#ffd700; color:#000; }

/* فیلتر و جستجو */
.filters {
    max-width:1200px; margin:20px auto; padding:0 20px; display:flex; flex-wrap:wrap; gap:15px;
    justify-content:center; align-items:center;
}
.filters input, .filters select {
    padding:10px 15px; border-radius:10px; border:none; background:rgba(255,255,255,0.1);
    color:#fff; font-family:inherit;
}
.filters input::placeholder { color:rgba(255,255,255,0.6); }

/* عنوان */
.section-title-wrapper { text-align:center; margin:40px 0 30px; }

/* گرید کارت‌ها */
.movies-grid {
    display:grid; grid-template-columns:repeat(4,1fr); gap:25px; justify-items:center;
    max-width:1200px; margin:0 auto; padding:0 20px;
}
.movies-grid.list { grid-template-columns:1fr; }
.movie-card {
    perspective:1200px; opacity:0; transform:translateY(50px); transition:opacity 0.8s, transform 0.8s;
}
.movie-card.visible { opacity:1; transform:translateY(0); }
.card-inner {
    position:relative; width:280px; height:420px; cursor:pointer;
    transition:transform 0.5s cubic-bezier(0.2,0.8,0.3,1); transform-style:preserve-3d;
}
.movies-grid.list .card-inner { width:100%; height:auto; }
.card-inner:hover { transform:translateZ(30px) rotateY(5deg) scale(1.05); } /* گزینه 45 */
.card-front, .card-back { /* همان قبلی با کمی بهبود */ }

/* کد تخفیف (گزینه 54) */
.discount-badge {
    position:absolute; top:10px; left:10px; background:#ff0000; color:#fff;
    padding:5px 12px; border-radius:8px; font-size:13px; font-weight:bold; z-index:5;
}

/* علاقه‌مندی */
.favorite-btn {
    position:absolute; top:10px; right:10px; background:rgba(0,0,0,0.5); width:40px; height:40px;
    border-radius:50%; display:flex; align-items:center; justify-content:center; z-index:5;
    color:#fff; font-size:18px; cursor:pointer;
}
.favorite-btn.active { color:#ffd700; }

/* مودال رزرو (گزینه 11) */
.modal {
    display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:100;
    align-items:center; justify-content:center;
}
.modal-content {
    background:#1a1a1a; padding:30px; border-radius:16px; width:90%; max-width:400px;
    border:2px solid #ffd700;
}
.modal input, .modal button {
    width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none;
}
.modal button { background:#ffd700; color:#000; font-weight:bold; cursor:pointer; }

/* بقیه استایل‌ها همان قبلی با کمی تمیزکاری */
@media (max-width:1200px) {.movies-grid{grid-template-columns:repeat(3,1fr);}}
@media (max-width:768px) {.movies-grid{grid-template-columns:repeat(2,1fr);}}
@media (max-width:480px) {.movies-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div id="loading-overlay"> <!-- لودر همان قبلی --> </div>

<!-- پس‌زمینه پارالاکس + پارتیکل -->
<canvas id="particles-canvas"></canvas>

<header>
    <button class="hamburger-btn" id="hamburger">...</button>
    <a href="index.html" class="logo-link"><div class="logo-fa">Soft Shiraz</div></a>
    <div class="controls">
        <button class="control-btn active" id="grid-view" title="نمایش گرید"><i class="fas fa-th"></i></button>
        <button class="control-btn" id="list-view" title="نمایش لیست"><i class="fas fa-list"></i></button>
    </div>
</header>

<!-- فیلترها -->
<div class="filters">
    <input type="text" id="search" placeholder="جستجوی نام فیلم...">
    <select id="genre-filter"><option value="">همه ژانرها</option></select>
    <select id="sort"><option value="soon">به‌زودی‌ترین</option><option value="name">نام</option></select>
</div>

<main>
    <section class="section-title-wrapper">
        <div class="section-title-box"><h2>اکران‌های آینده</h2></div>
    </section>
    <div class="movies-grid" id="cards-container"></div>
</main>

<!-- مودال رزرو -->
<div class="modal" id="reserve-modal">
    <div class="modal-content">
        <h3>رزرو بلیط</h3>
        <input type="text" id="reserve-name" placeholder="نام و نام خانوادگی">
        <input type="number" id="reserve-count" placeholder="تعداد بلیط" min="1">
        <input type="tel" id="reserve-phone" placeholder="شماره تماس">
        <button id="send-reserve">ارسال به تلگرام</button>
        <button onclick="document.getElementById('reserve-modal').style.display='none'">بستن</button>
    </div>
</div>

<script>
// داده‌ها از JSON
let events = [];
let filteredEvents = [];
async function loadData() {
    try {
        const res = await fetch('data.json?v=' + Date.now(), {cache:"no-store"});
        events = await res.json();
        filteredEvents = [...events];
        renderCards();
        populateGenreFilter();
    } catch(e) { console.error("خطا در لود data.json"); }
}
loadData();

// رندر کارت‌ها با انیمیشن ورود (گزینه 41)
function renderCards() {
    const container = document.getElementById("cards-container");
    container.innerHTML = "";
    filteredEvents.forEach((event, i) => {
        const card = document.createElement("div");
        card.className = "movie-card";
        card.innerHTML = `
            <div class="card-inner">
                ${event.discount ? `<div class="discount-badge">${event.discount}</div>` : ''}
                <div class="favorite-btn" data-id="${event.id}"><i class="far fa-heart"></i></div>
                <div class="card-front" data-admin-id="${event.adminId || 'softshirazadmin'}">
                    <div class="img-bar"><img src="${event.image}" loading="lazy" alt="${event.title}"></div>
                    <div class="date-bar"><strong>${event.date}</strong></div>
                    <div class="title-bar">${event.title}</div>
                    <div class="reserve-bar" data-id="${event.id}">تهیه بلیط</div>
                </div>
                <div class="card-back"> <!-- محتوای پشت کارت --> </div>
            </div>`;
        container.appendChild(card);
    });

    // انیمیشن ورود هنگام اسکرول
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add("visible");
        });
    }, {threshold: 0.1});
    document.querySelectorAll('.movie-card').forEach(c => observer.observe(c));

    updateFavorites();
}

// جستجو + فیلتر + سورت
document.getElementById("search").addEventListener("input", filter);
document.getElementById("genre-filter").addEventListener("change", filter);
document.getElementById("sort").addEventListener("change", filter);

function filter() {
    let query = document.getElementById("search").value.toLowerCase();
    let genre = document.getElementById("genre-filter").value;
    let sort = document.getElementById("sort").value;

    filteredEvents = events.filter(e => {
        return (!query || e.title.toLowerCase().includes(query)) &&
               (!genre || e.genre === genre);
    });

    if (sort === "name") filteredEvents.sort((a,b) => a.title.localeCompare(b.title));
    // به‌زودی‌ترین بر اساس تاریخ (فرض YYYY-MM-DD)
    if (sort === "soon") filteredEvents.sort((a,b) => new Date(a.date) - new Date(b.date));

    renderCards();
}

function populateGenreFilter() {
    const genres = [...new Set(events.map(e => e.genre))];
    const select = document.getElementById("genre-filter");
    genres.forEach(g => {
        const opt = document.createElement("option");
        opt.value = g; opt.textContent = g;
        select.appendChild(opt);
    });
}

// علاقه‌مندی‌ها (گزینه 12)
function updateFavorites() {
    let favs = JSON.parse(localStorage.getItem("favorites") || "[]");
    document.querySelectorAll(".favorite-btn").forEach(btn => {
        let id = btn.dataset.id;
        if (favs.includes(id)) btn.innerHTML = '<i class="fas fa-heart"></i>';
        btn.onclick = () => {
            if (favs.includes(id)) favs = favs.filter(f => f !== id);
            else favs.push(id);
            localStorage.setItem("favorites", JSON.stringify(favs));
            updateFavorites();
            updateSidebarFavorites();
        };
    });
}

function updateSidebarFavorites() {
    // در سایدبار یه بخش جدید اضافه کن (کد سایدبار رو خودت آپدیت کن)
}

// Grid / List View (گزینه 7)
document.getElementById("grid-view").onclick = () => {
    document.querySelector(".movies-grid").classList.remove("list");
    document.getElementById("grid-view").classList.add("active");
    document.getElementById("list-view").classList.remove("active");
};
document.getElementById("list-view").onclick = () => {
    document.querySelector(".movies-grid").classList.add("list");
    document.getElementById("list-view").classList.add("active");
    document.getElementById("grid-view").classList.remove("active");
};

// رزرو با مودال (گزینه 11)
let currentEvent = null;
document.addEventListener("click", e => {
    const reserveBar = e.target.closest(".reserve-bar");
    if (reserveBar) {
        const card = reserveBar.closest(".card-front");
        currentEvent = events.find(ev => ev.id == reserveBar.dataset.id);
        document.getElementById("reserve-modal").style.display = "flex";
    }
});
document.getElementById("send-reserve").onclick = () => {
    if (!currentEvent) return;
    let name = document.getElementById("reserve-name").value || "مشتری";
    let count = document.getElementById("reserve-count").value || 1;
    let phone = document.getElementById("reserve-phone").value || "";
    let msg = `سلام\nدرخواست رزرو:\nفیلم: ${currentEvent.title}\nتاریخ: ${currentEvent.date}\nنام: ${name}\nتعداد: ${count}\nشماره: ${phone}`;
    window.open(`https://t.me/${currentEvent.adminId || 'softshirazadmin'}?text=${encodeURIComponent(msg)}`);
    document.getElementById("reserve-modal").style.display = "none";
};

// پارتیکل + پارالاکس همان قبلی با کمی بهینه‌سازی
// ... (کد پارتیکل قبلی رو اینجا بذار)

// لودر ۵ ثانیه همان قبلی
</script>

<!-- بقیه اسکریپت‌های منو، فلیپ کارت و ... همان قبلی -->
</body>
</html>
