<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>سافت شیراز - اکران‌های آینده</title>

<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- PWA manifest -->
<link rel="manifest" href="manifest.json">

<style>
/* 기본 ریست */
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; }

/* پس‌زمینه تیره با گرادیانت و انیمیشن */
body { 
    font-family: "Vazirmatn", sans-serif; 
    background:#0e0e0f;
    color:#fff;
    overflow-x:hidden;
    position:relative;
}

/* سه‌بعدی (Three.js) canvas روی پس‌زمینه */
#three-canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none; /* پس‌زمینه تعاملی نباشد */
}

/* ذرات طلایی (حفظ شد) */
#gold-particles { position: fixed; top:0; left:0; width:100%; height:100%; overflow:hidden; pointer-events:none; z-index:0; }
.particle { position:absolute; width:4px; height:4px; background:rgba(255,215,0,0.85); border-radius:50%; box-shadow:0 0 8px rgba(255,215,0,0.95); animation: floatDown linear infinite; }
@keyframes floatDown { from { transform: translateY(-120vh); opacity:1; } to { transform: translateY(120vh); opacity:0; } }

/* هدر */
header {
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(8px);
    padding:12px 22px;
    display:flex; justify-content:flex-end; align-items:center;
    border-bottom:1px solid rgba(48,48,48,0.45);
    position:sticky; top:0; z-index:30;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
}
.logo-fa {
    font-weight:700;
    font-size:24px;
    background:linear-gradient(45deg,#ffd700,#ffb300);
    -webkit-background-clip:text;
    color:transparent;
    text-shadow: 0 0 18px rgba(255,215,0,0.15);
}

/* محتوا */
main { padding:35px 15px 80px; position:relative; z-index:10; }
h2 {
    color:#ffd700; font-size:28px; text-align:center;
    margin-bottom:28px; border-bottom:3px solid #ffd700;
    display:inline-block; padding-bottom:6px;
    text-shadow:0 0 8px rgba(255,215,0,0.25);
}

/* شبکه کارت‌ها */
.section { text-align:center; }
.movies-grid {
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:20px;
    justify-items:center;
    max-width:1200px;
    margin:0 auto;
}

/* کارت فیلم - هولوگرام / شیشه‌ای */
.movie-card { perspective:1200px; width:280px; height:420px; position:relative; }
.card-inner {
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.5s ease, box-shadow 0.3s ease;
    width: 100%;
    height: 100%;
    border-radius:14px;
    overflow:hidden;
    cursor:pointer;
    will-change: transform;
    border: 1px solid rgba(255,215,0,0.06); /* خط طلایی ملایم */
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.35));
    backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 8px 28px rgba(0,0,0,0.6), 0 2px 12px rgba(255,215,0,0.03) inset;
}

/* افکت هولوگرافیک نور روی hover (نور متغیر با ماوس) */
.card-light {
    position:absolute; inset:0; pointer-events:none; mix-blend-mode:screen; opacity:0.8;
    background: radial-gradient(400px 200px at var(--mx,50%) var(--my,40%), rgba(255,235,170,0.09), transparent 12%);
    transition: background 0.2s linear;
}

/* تصویر فیلم */
.img-bar { width:100%; height:68%; overflow:hidden; display:block; }
.img-bar img { width:100%; height:100%; object-fit:cover; transform-origin:center; transition: transform 0.35s ease; }

/* نوار تاریخ، عنوان، رزرو */
.date-bar, .title-bar, .reserve-bar {
    height:38px; line-height:38px;
    padding:0 12px; text-align:center;
    font-size:14px; user-select:none;
}
.date-bar { color:#ffd700; background:rgba(0,0,0,0.25); border-top:1px solid rgba(255,255,255,0.03); }
.title-bar { color:#fff; background: rgba(0,0,0,0.18); }
.reserve-bar {
    color:#000; background: linear-gradient(180deg,#ffd700,#ffbf2f);
    font-weight:700; cursor:pointer; border-radius:8px; margin:10px auto 0; width:86%;
    box-shadow: 0 6px 18px rgba(255,183,0,0.09), 0 0 36px rgba(255,215,0,0.04) inset;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    position:relative; z-index:5;
}

/* پالس نرم روی دکمه رزرو */
@keyframes gentlePulse {
  0% { box-shadow: 0 6px 18px rgba(255,183,0,0.09); transform: scale(1); }
  50% { box-shadow: 0 10px 30px rgba(255,183,0,0.12); transform: scale(1.02); }
  100% { box-shadow: 0 6px 18px rgba(255,183,0,0.09); transform: scale(1); }
}
.reserve-bar.pulse { animation: gentlePulse 3.8s ease-in-out infinite; }

/* کارت ظاهر شدن Fade+Slide */
.movie-card { opacity:0; transform: translateY(18px) scale(0.995); transition: opacity 0.7s ease, transform 0.7s cubic-bezier(.2,.9,.3,1); }
.movie-card.show { opacity:1; transform: translateY(0) scale(1); }

/* هولوگرام دکمه‌ها */
.holo-btn {
    display:inline-flex; align-items:center; justify-content:center;
    padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,0.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    box-shadow: 0 6px 20px rgba(255,215,0,0.03);
    color:#ffd700; cursor:pointer; text-decoration:none;
    transition: transform 0.18s ease, box-shadow 0.18s ease;
}
.holo-btn:active { transform: translateY(2px) scale(0.996); }

/* پاپ‌آپ درباره ما بزرگ‌تر و زیبا */
#about-popup {
    display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    width:420px; max-width:92%; background: rgba(12,12,12,0.9); backdrop-filter: blur(14px);
    border:2px solid rgba(255,215,0,0.45); border-radius:14px; padding:18px; font-size:14px; text-align:right; z-index:60;
    color:#fff; box-shadow: 0 18px 60px rgba(0,0,0,0.8);
}
#about-popup.show { display:block; }
#about-popup .header { display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:12px; }
#about-popup img { width:84px; height:84px; object-fit:cover; border-radius:10px; border:1px solid rgba(255,255,255,0.04); }
#about-popup .content { text-align:right; line-height:1.6; margin-bottom:12px; }
#about-popup .links { display:flex; gap:8px; justify-content:flex-start; direction:ltr; }
#about-popup .close-btn { background:transparent; border:0; color:#ffd700; font-size:18px; cursor:pointer; }

/* فوتر و آیکون‌های بامزه */
footer {
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
    padding:28px 18px; text-align:center; border-top:1px solid rgba(48,48,48,0.45);
    position:relative; z-index:10;
}
.footer-title { font-size:18px; color:#ffd700; margin-bottom:14px; }

.social-row { display:flex; justify-content:center; gap:14px; align-items:center; }
.social-icon {
    width:54px; height:54px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.25));
    border: 1px solid rgba(255,255,255,0.03);
    box-shadow: 0 8px 22px rgba(0,0,0,0.6);
    transition: transform .25s ease;
    color: #ffd700; font-size:22px;
}
.social-icon:hover { transform: translateY(-6px) rotate(-6deg); }

/* آیکون‌های سفارشی بامزه - داخل svg */
.social-icon .bubble { display:block; width:36px; height:36px; border-radius:8px; }

/* صفحه اختصاصی فیلم - سبک پایه */
.movie-page {
    max-width:1100px; margin:40px auto; background: rgba(12,12,12,0.55); padding:22px; border-radius:12px;
    border:1px solid rgba(255,215,0,0.04);
}

/* ریسپانسیو */
@media (max-width:1200px) { .movies-grid{grid-template-columns:repeat(3,1fr);} }
@media (max-width:768px)  { .movies-grid{grid-template-columns:repeat(2,1fr);} }
@media (max-width:480px)  { .movies-grid{grid-template-columns:1fr;} }
</style>
</head>
<body>

<!-- Three.js canvas for cinematic background -->
<canvas id="three-canvas"></canvas>

<!-- ذرات طلایی (حفظ) -->
<div id="gold-particles"></div>

<!-- لودر (دست نخورده) -->
<div id="loading-overlay">
  <div class="loader" aria-hidden="true">
    <div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div>
  </div>
</div>

<header><div class="logo-fa">Soft Shiraz</div></header>

<main>
    <section class="section">
        <h2>اکران‌های آینده</h2>
        <div class="movies-grid" id="cards-container"></div>
    </section>
</main>

<footer>
    <div class="footer-title">شبکه‌های اجتماعی سافت شیراز</div>
    <div class="social-row">
        <!-- آیکون‌های بامزه سفارشی (SVG inline) -->
        <a class="social-icon" href="https://t.me/softshiraz" target="_blank" aria-label="Telegram">
            <span class="bubble" style="display:flex;align-items:center;justify-content:center;">
                <!-- استایل کارتونی تلگرام -->
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M3 12l18-7-4 18-5-7-3 3-6-7z" fill="#ffd700" opacity="0.95"/>
                </svg>
            </span>
        </a>

        <a class="social-icon" href="https://instagram.com/softshiraz" target="_blank" aria-label="Instagram">
            <span class="bubble" style="display:flex;align-items:center;justify-content:center;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <rect x="3" y="3" width="18" height="18" rx="5" fill="#ffd700" opacity="0.95"/>
                </svg>
            </span>
        </a>

        <button class="social-icon" id="about-btn" aria-label="درباره ما" title="درباره ما">
            <span style="font-size:18px;">✨</span>
        </button>
    </div>

    <!-- پاپ‌آپ درباره ما جدید -->
    <div id="about-popup" role="dialog" aria-hidden="true" aria-label="درباره سافت شیراز">
        <div class="header">
            <div style="display:flex;gap:12px;align-items:center;">
                <img src="https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?q=80&w=400&auto=format&fit=crop&ixlib=rb-4.0.3&s=placeholder" alt="SoftShiraz" />
                <div style="text-align:right;">
                    <strong style="color:#ffd700;">سافت شیراز</strong>
                    <div style="font-size:13px;color:#ddd;margin-top:6px;">مرجع معرفی فیلم‌های آینده و اخبار سینما</div>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
                <button class="close-btn" id="about-close" title="بستن">✕</button>
                <small style="color:#ccc;">تأسیس: ۱۳۹۸</small>
            </div>
        </div>
        <div class="content">
            <p>سافت شیراز هر روز اکران‌های آینده، تریلرها، نقد کوتاه و اطلاعات کامل بازیگران را جمع‌آوری می‌کند. هدف ما تجربهٔ سینمایی لوکس و دسترسی سریع به اطلاعات است.</p>
            <p style="margin-top:8px;"><strong>تماس:</strong> <a href="mailto:hello@softshiraz.example" style="color:#ffd700">hello@softshiraz.example</a></p>
        </div>
        <div class="links">
            <a class="holo-btn" href="https://t.me/softshiraz" target="_blank">تلگرام</a>
            <a class="holo-btn" href="https://instagram.com/softshiraz" target="_blank">اینستاگرام</a>
        </div>
    </div>
</footer>

<script>
// -----------------------------
// Particles (gold) - همان‌طور که بود
// -----------------------------
const particleContainer = document.getElementById("gold-particles");
for (let i = 0; i < 80; i++) {
    const p = document.createElement("div");
    p.className = "particle";
    const size = Math.random() * 3 + 2;
    p.style.width = size + "px";
    p.style.height = size + "px";
    p.style.left = Math.random() * 100 + "%";
    p.style.top = Math.random() * -100 + "vh";
    p.style.animationDuration = Math.random() * 4 + 4 + "s";
    p.style.animationDelay = Math.random() * 3 + "s";
    particleContainer.appendChild(p);
}

// لودینگ — تغییر ندادیم
window.addEventListener('load', () => {
    setTimeout(() => {
        document.getElementById('loading-overlay').classList.add('hidden');
    }, 5000);
});

/* ----------------------------------------------------------------
   بارگذاری کارت‌ها از پوشهٔ cards (مثل قبل). اما:
   - کلیک روی کارت → هدایت به movie.html?id=NUM
   - کلیک روی دکمه رزرو، جلوی bubbling می‌گیرد (دیگر باعث flip نمی‌شود)
   - کارت‌ها با افکت Fade+Slide نمایش داده می‌شوند
-----------------------------------------------------------------*/
const container = document.getElementById("cards-container");

async function loadCardsStrictly() {
    for (let num = 1; num <= 12; num++) {
        try {
            const response = await fetch(`cards/${num}.html`, { cache: "no-store" });
            if (!response.ok) continue;
            const html = await response.text();
            const wrapper = document.createElement("div");
            wrapper.className = "movie-card";
            wrapper.dataset.num = String(num);
            wrapper.innerHTML = html;
            container.appendChild(wrapper);

            // ظاهر شدن انیمیشنی با تاخیر جزئی برای هر کارت
            setTimeout(()=> wrapper.classList.add("show"), 80 * num);

            // کلیک روی کارت (جز رزرو) => صفحه فیلم
            wrapper.addEventListener('click', (e) => {
                // اگر هدف رزرو بود، اینجا نباید اجرا شود (reserve handler stopPropagation می‌کند)
                const id = wrapper.dataset.num || num;
                window.location.href = `movie.html?id=${id}`;
            });

            // جلوگیری از چرخش یا رفتار ناخواسته وقتی روی دکمه رزرو کلیک می‌کنیم
            const reserveButton = wrapper.querySelector(".reserve-bar");
            if (reserveButton) {
                // ایست‌بابلینگ تا رویداد کلیک به wrapper منتقل نشود
                reserveButton.addEventListener("click", (evt) => {
                    evt.stopPropagation();
                    // رفتار دلخواه — میتواند لینک به تلگرام یا باز کردن پنجرهٔ خرید باشد
                    // در اینجا نمونه: باز کردن چت تلگرام در تب جدید
                    window.open("https://t.me/softshiraz", "_blank");
                });
                // اضافه کردن انیمیشن پالس (کلاس)
                reserveButton.classList.add('pulse');
            }

            // افکت hover/tilt و نور که با حرکت ماوس تغییر کند
            const inner = wrapper.querySelector(".card-inner") || wrapper.firstElementChild;
            const img = wrapper.querySelector("img");
            wrapper.addEventListener('mousemove', (ev) => {
                const rect = wrapper.getBoundingClientRect();
                const px = (ev.clientX - rect.left) / rect.width;
                const py = (ev.clientY - rect.top) / rect.height;
                const rotateY = (px - 0.5) * 12; // زاویه X
                const rotateX = (py - 0.5) * -10; // زاویه Y
                if(inner) inner.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg) scale(1.02)`;
                // نور هولوگرافیک
                wrapper.style.setProperty('--mx', (px*100) + '%');
                wrapper.style.setProperty('--my', (py*100) + '%');
                if(img) img.style.transform = `scale(1.06) translateZ(0)`;
            });
            wrapper.addEventListener('mouseleave', () => {
                if(inner) inner.style.transform = '';
                if(img) img.style.transform = '';
            });

        } catch (e) {
            console.log("خطا در لود کارت", num, e);
        }
    }
}

loadCardsStrictly();

/* ---------------------------
   پاپ‌آپ درباره ما
----------------------------*/
const aboutBtn = document.getElementById("about-btn");
const aboutPopup = document.getElementById("about-popup");
const aboutClose = document.getElementById("about-close");

aboutBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    aboutPopup.classList.toggle("show");
    aboutPopup.setAttribute('aria-hidden', aboutPopup.classList.contains('show') ? 'false' : 'true');
});
aboutClose.addEventListener("click", ()=> {
    aboutPopup.classList.remove("show");
});
document.addEventListener("click", (e) => {
    if (!aboutPopup.contains(e.target) && e.target !== aboutBtn) aboutPopup.classList.remove("show");
});

/* جلوگیری از رفتارهای ناخواسته دسترسی (keyboard) */
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') aboutPopup.classList.remove("show");
});

/* ---------------------------
   Three.js cinematic background (base)
   - دود سه‌بعدی سبک، نورپردازی طلایی، ذرات واکنش‌گرا به موس
   - پیاده‌سازی پایه؛ می‌توانید پارامترها را با توجه به نیازتان تغییر دهید.
----------------------------*/
(function initThreeBackground(){
    // بارگذاری از CDN (اگر قبلا با <script> اضافه شود، این تابع بایستی تطبیق یابد)
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r146/three.min.js';
    script.onload = () => {
        const canvas = document.getElementById('three-canvas');
        const renderer = new THREE.WebGLRenderer({canvas: canvas, antialias:true, alpha:true});
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0,0,45);

        // نور طلایی محیطی
        const ambient = new THREE.AmbientLight(0xfff4d6, 0.2);
        scene.add(ambient);

        // نقطه نور گرم متحرک
        const point = new THREE.PointLight(0xffd27a, 1.2, 300);
        point.p
