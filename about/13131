<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0">
    <title>ğŸ¬ Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø² : SoftShiraz ğŸ¬</title>

    <meta name="description" content="@soft_shiraz - Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø²">
    <meta name="theme-color" content="#ffd700">
    <link rel="manifest" href="/web/manifest.json">

    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/dist/font-face.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
    /* =========================================
       1. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ (Global Styles)
       ========================================= */
    :root {
        --color-primary: #ffd700;
        --color-secondary: #ffb300;
        --accent-text: #ffd700;
        --bg-color: #0e0e0f;
        --text-color: #fff;
        --header-bg: rgba(0,0,0,0.5);
        --border-color: rgba(48,48,48,0.5);
        --menu-bg-start: rgba(12,12,12,0.98);
        --menu-bg-end: rgba(20,20,20,0.98);
        --link-bg: rgba(255,255,255,0.03);
        --glow-color: rgba(255,215,0,0.5);
        --card-bg: rgba(19,19,20,0.75);
    }
    .light-mode {
        --color-primary: #4a90e2;
        --color-secondary: #357abd;
        --accent-text: #ffffff;
        --bg-color: #f8fbff;
        --text-color: #1a2b4b;
        --header-bg: rgba(255,255,255,0.92);
        --border-color: rgba(74,144,226,0.25);
        --menu-bg-start: rgba(248,251,255,0.98);
        --menu-bg-end: rgba(240,245,255,0.98);
        --link-bg: rgba(74,144,226,0.08);
        --glow-color: rgba(74,144,226,0.5);
        --card-bg: rgba(255,255,255,0.92);
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body {
        font-family: "Vazirmatn", sans-serif;
        background:var(--bg-color);
        color:var(--text-color);
        overflow-x:hidden;
        transition: background-color 0.3s, color 0.3s;
    }

    /* =========================================
       2. Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± (Header Styles)
       ========================================= */
    header {
        background: var(--header-bg);
        backdrop-filter: blur(10px);
        padding:15px 25px;
        display:flex; justify-content:space-between; align-items:center;
        border-bottom:1px solid var(--border-color);
        position:sticky; top:0; z-index:20;
        text-shadow:0 0 10px var(--glow-color);
    }
    .logo-link { text-decoration: none; cursor: pointer; }
    .logo-fa {
        font-weight:700; font-size:26px;
        background:linear-gradient(45deg,var(--color-primary),var(--color-secondary));
        -webkit-background-clip:text; color:transparent;
        transition: all 0.3s ease;
    }
    .logo-link:hover .logo-fa { text-shadow: 0 0 20px var(--glow-color); transform: scale(1.05); }
    .hamburger-btn {
        width:48px; height:48px; display:flex; align-items:center; justify-content:center;
        background: var(--link-bg); border-radius:14px; border:2px solid var(--link-bg);
        cursor:pointer; transition:all .3s ease; color:var(--color-primary);
        box-shadow: 0 0 15px var(--glow-color);
    }
    .hamburger-btn:hover {
        background: rgba(255,215,0,0.06); border-color:var(--color-primary);
        transform: scale(1.08); box-shadow: 0 0 25px var(--glow-color);
    }
    .hamburger-inner { width:24px; height:18px; position:relative; }
    .hamburger-inner span { position:absolute; left:0; right:0; height:3px; background:var(--color-primary); display:block; border-radius:3px; transition:all .3s; }
    .hamburger-inner span:nth-child(1){ top:0; }
    .hamburger-inner span:nth-child(2){ top:7.5px; }
    .hamburger-inner span:nth-child(3){ top:15px; }
    .hamburger-btn[aria-expanded="true"] .hamburger-inner span:nth-child(1) { transform: rotate(45deg); top:7.5px; }
    .hamburger-btn[aria-expanded="true"] .hamburger-inner span:nth-child(2) { opacity:0; }
    .hamburger-btn[aria-expanded="true"] .hamburger-inner span:nth-child(3) { transform: rotate(-45deg); top:7.5px; }

    /* =========================================
       3. Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ù†Ùˆ (Menu Styles)
       ========================================= */
    #side-menu {
        position: fixed; top: 0; right: 0; height: 100vh; width: 320px; max-width: 85%;
        background: linear-gradient(180deg, var(--menu-bg-start), var(--menu-bg-end));
        box-shadow: 4px 0 30px rgba(0,0,0,0.6);
        transform: translateX(100%); transition: transform 0.32s cubic-bezier(.2,.9,.2,1);
        z-index: 30; padding: 28px; display: flex; flex-direction: column; gap: 18px;
        direction: rtl; border-right: 2px solid var(--border-color);
    }
    #side-menu.open { transform: translateX(0); }
    .menu-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 20px; }
    .menu-controls { display: flex; gap: 8px; justify-content: space-between; width: 100%; }
    #menu-close, #theme-toggle {
        width: 44px; height: 44px; background: var(--link-bg);
        border: 2px solid var(--link-bg); border-radius: 12px;
        color: var(--color-primary); font-size: 24px; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: all 0.3s;
    }
    #menu-close:hover, #theme-toggle:hover {
        background: var(--color-primary); color: var(--bg-color); border-color: var(--color-primary);
    }
    .side-brand { font-weight:800; color:var(--color-primary); font-size:20px; margin: -10px 0 10px 0; text-align: center; }
    .side-links a {
        display:flex; align-items:center; justify-content:space-between; padding:12px 14px; 
        border-radius:10px; text-decoration:none; color:var(--text-color); font-weight:600;
        background:var(--link-bg); border:1px solid var(--link-bg); transition: all 0.3s;
    }
    .side-links a:hover { background:rgba(255,215,0,0.06); color:var(--color-primary); }
    .menu-social-row { display: flex; justify-content: center; gap: 18px; margin-top: 12px; }
    .menu-install-icon, .menu-social-icon {
        width: 48px; height: 48px; border-radius: 12px; background:var(--link-bg);
        display: flex; align-items: center; justify-content: center;
        color: var(--color-primary); font-size: 22px; text-decoration: none; 
        transition: all 0.3s; cursor: pointer; border: 2px solid var(--link-bg);
    }
    .menu-install-icon:hover, .menu-social-icon:hover { background: rgba(255,215,0,0.06); border-color: var(--color-primary); }
    .side-footer-text { margin-top: auto; font-size: 13px; color: rgba(255,255,255,0.7); padding-top: 20px; text-align: center; }
    #menu-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.55); opacity:0; pointer-events:none; transition:opacity .28s; z-index:25; }
    #menu-backdrop.visible { opacity:1; pointer-events:auto; }

    /* =========================================
       4. Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ø­ØªÙˆØ§ Ùˆ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ (Main & Cards)
       ========================================= */
    .section-title-wrapper {
        max-width: 1200px; margin: 40px auto 50px auto; padding: 0 20px; display: flex; justify-content: center;
    }
    .section-title-box {
        width: 280px; background: rgba(255,215,0,0); backdrop-filter: blur(10px);
        border: 2px solid var(--color-primary); border-radius: 18px; padding: 16px 20px;
        box-shadow: 0 0 20px var(--glow-color), inset 0 0 15px var(--glow-color);
        animation: glowPulse 4s ease-in-out infinite alternate; text-align: center;
    }
    .light-mode .section-title-box { background: rgba(74,144,226,0.15); }
    .section-title-box h1 {
        color: var(--accent-text); font-size: 32px; font-weight: 900; margin: 0;
        text-shadow: 0 0 10px var(--glow-color); letter-spacing: 2px;
    }
    @keyframes glowPulse {
        from { box-shadow: 0 0 20px var(--glow-color), inset 0 0 15px var(--glow-color); }
        to { box-shadow: 0 0 30px var(--glow-color), inset 0 0 20px var(--glow-color); }
    }
    .movies-grid {
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        justify-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px;
    }
    .movie-card { perspective:1000px; position: relative; }
    .card-inner {
        position:relative; width:280px; height:420px; cursor:pointer;
        transition:transform 0.65s cubic-bezier(0.5, 1.25, 0.5, 1.25);
        transform-style:preserve-3d;
    }
    .card-inner.flipped { transform:rotateY(180deg); }
    .card-front, .card-back {
        position:absolute; top:0; left:0; width:100%; height:100%; border-radius:16px; overflow:hidden;
        backface-visibility:hidden; border:2px solid var(--border-color);
        box-shadow:0 0 8px var(--glow-color), inset 0 0 6px var(--glow-color);
        background:var(--card-bg); backdrop-filter:blur(10px);
    }
    .card-front { display:flex; flex-direction:column; position: relative; }
    .img-bar { flex:1; overflow:hidden; }
    .img-bar img { width:100%; height:100%; object-fit:cover; }
    .date-bar {
        height:52px !important; line-height:52px !important; padding:0 10px; text-align:center;
        background: rgba(255,215,0,0.12); color: var(--accent-text);
        font-size:19px !important; font-weight:900 !important; text-shadow:0 0 14px var(--glow-color);
    }
    .light-mode .date-bar { background: rgba(74,144,226,0.25); }
    .title-bar {
        height:36px; line-height:36px; padding:0 10px; text-align:center;
        background:var(--link-bg); border-top:1px solid var(--link-bg);
        color:var(--text-color); font-weight:600; font-size:15px;
    }
    .reserve-bar {
        height:36px; line-height:36px; padding:0 10px; text-align:center;
        background:var(--color-primary); color:var(--bg-color); font-weight:bold; cursor:pointer; transition:background 0.3s;
    }
    .reserve-bar:hover { background:#ffea00; }
    .card-back {
        transform:rotateY(180deg); padding:15px; color:var(--text-color); text-align:right;
        font-size:14px; display:flex; flex-direction:column;
    }
    .card-back h3, .card-back p strong { color:var(--color-primary); }
    .discount-label {
        position: absolute; top: 0; right: 0;
        background: linear-gradient(135deg, #c084fc, #f472b6);
        color: white; font-weight: bold; font-size: 13px; padding: 6px 12px;
        border-radius: 0 0 0 12px; z-index: 10; animation: pulse 2s infinite;
    }
    .discount-label.hidden { display: none; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

    /* =========================================
       5. Ù„ÙˆØ¯Ø± (Loader)
       ========================================= */
    #loading-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background:var(--bg-color);
        display: flex; justify-content: center; align-items: center; z-index: 10000;
        opacity: 1; transition: opacity 0.9s ease;
    }
    #loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .loader { position: relative; width: 40px; height: 40px; }
    .loader .circle { position: absolute; width: 38px; height: 38px; opacity: 0; transform: rotate(225deg); animation: orbit 5.5s infinite; }
    .loader .circle:after { content: ''; position: absolute; width: 5px; height: 5px; border-radius: 50%; background: var(--color-primary); }
    .loader .circle:nth-child(2) { animation-delay: 240ms; }
    .loader .circle:nth-child(3) { animation-delay: 480ms; }
    .loader .circle:nth-child(4) { animation-delay: 720ms; }
    .loader .circle:nth-child(5) { animation-delay: 960ms; }
    @keyframes orbit {
        0% { transform:rotate(225deg); opacity: 1; animation-timing-function: ease-out; }
        7% { transform:rotate(345deg); animation-timing-function: linear; }
        30% { transform:rotate(455deg); animation-timing-function: ease-in-out; }
        39% { transform:rotate(690deg); animation-timing-function: linear; }
        70% { transform:rotate(815deg); opacity: 1; animation-timing-function: ease-out; }
        75% { transform:rotate(945deg); animation-timing-function: ease-out; }
        76% { transform:rotate(945deg); opacity: 0; }
        100% { transform:rotate(945deg); opacity: 0; }
    }
    @media (max-width:1200px) { .movies-grid { grid-template-columns:repeat(3,1fr); } }
    @media (max-width:768px) { .movies-grid { grid-template-columns:repeat(2,1fr); } }
    @media (max-width:480px) { .movies-grid { grid-template-columns:1fr; } }
    </style>
</head>
<body>

<div id="loading-overlay">
  <div class="loader">
    <div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div><div class="circle"></div>
  </div>
</div>

<header>
    <button class="hamburger-btn" id="hamburger" aria-controls="side-menu" aria-expanded="false" aria-label="Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ">
        <span class="hamburger-inner" aria-hidden="true"><span></span><span></span><span></span></span>
    </button>
    <a href="./index.html" class="logo-link">
        <div class="logo-fa">Soft Shiraz</div>
    </a>
</header>

<div id="menu-backdrop" tabindex="-1"></div>
<nav id="side-menu" aria-hidden="true">
    <div class="menu-header">
        <div class="menu-controls">
            <button id="menu-close" aria-label="Ø¨Ø³ØªÙ† Ù…Ù†Ùˆ"><i class="fas fa-times"></i></button>
            <button id="theme-toggle" aria-label="ØªØºÛŒÛŒØ± ØªÙ…"><i class="fas fa-sun"></i></button>
        </div>
    </div>
    <div class="side-brand">Ø§ÛŒÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ø·Ù„Ø§ÛŒÛŒ Ø³Ø§ÙØª Ø´ÛŒØ±Ø§Ø²</div>
    <div class="side-links" role="menu">
        <a href="../web/events/events.html" role="menuitem">Ø§ÛŒÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ú©ØªØ§Ø¨Ø®ÙˆØ§Ù†ÛŒ</a>
        <a href="../web/room/room.html" role="menuitem">Ø§ØªØ§Ù‚Ú©</a>
        <a href="../web/about/about.html" role="menuitem">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
    </div>
    <div class="menu-social-row">
        <div class="menu-install-icon" id="install-button" title="Ù†ØµØ¨ Ø§Ù¾" style="display:none;"><i class="fas fa-download"></i></div>
        <a class="menu-social-icon" href="https://t.me/softshiraz" target="_blank"><i class="fab fa-telegram"></i></a>
        <a class="menu-social-icon" href="https://instagram.com/soft_shiraz" target="_blank"><i class="fab fa-instagram"></i></a>
        <a class="menu-social-icon" href="https://t.me/FLOKI000" target="_blank"><i class="fas fa-headset"></i></a>
    </div>
    <div class="side-footer-text">Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· ÙÙ„ÙˆÚ©ÛŒ</div>
</nav>

<main style="padding-top:0px;">
    <section class="section">
        <div class="section-title-wrapper">
            <div class="section-title-box">
                <h1>Ø§Ú©Ø±Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</h1>
            </div>
        </div>
        <div class="movies-grid" id="cards-container" style="margin-bottom: 45px;"></div>
    </section>
</main>

<script>
(() => {
  const canvas = document.createElement('canvas');
  document.body.appendChild(canvas);
  canvas.style.position = 'fixed'; canvas.style.top = '0'; canvas.style.left = '0';
  canvas.style.pointerEvents = 'none'; canvas.style.zIndex = '-1';
  const ctx = canvas.getContext('2d');
  let w, h, particles = [], N = 120, maxDist = 120;
  function resize() { w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
  addEventListener('resize', resize);
  resize();
  function rand(a, b) { return Math.random() * (b - a) + a; }
  function init() {
    particles = [];
    for (let i = 0; i < N; i++) {
      particles.push({
        x: rand(0, w), y: rand(0, h),
        vx: rand(-0.45, 0.45), vy: rand(-0.45, 0.45),
        r: rand(0.8, 2.2), a: rand(0.4, 0.95)
      });
    }
  }
  function frame() {
    ctx.clearRect(0, 0, w, h);
    const isLight = document.body.classList.contains('light-mode');
    const particleColor = isLight ? '74,144,226' : '255,215,0';
    const lineOpacityFactor = isLight ? 0.35 : 0.22;
    for (let p of particles) {
      p.x += p.vx; p.y += p.vy;
      if (p.x < 0) p.x = w; if (p.x > w) p.x = 0;
      if (p.y < 0) p.y = h; if (p.y > h) p.y = 0;
      ctx.beginPath();
      ctx.fillStyle = `rgba(${particleColor},${p.a * 0.9})`;
      ctx.arc(p.x, p.y, p.r, 0, 6.28);
      ctx.fill();
    }
    ctx.lineWidth = 0.7;
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const p = particles[i], q = particles[j];
        const d = Math.hypot(p.x - q.x, p.y - q.y);
        if (d < maxDist) {
          ctx.beginPath();
          ctx.strokeStyle = `rgba(${particleColor},${(1 - d / maxDist) * lineOpacityFactor})`;
          ctx.moveTo(p.x, p.y); ctx.lineTo(q.x, q.y);
          ctx.stroke();
        }
      }
    }
    requestAnimationFrame(frame);
  }
  init();
  frame();
})();
</script>

<script>
// 1. Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ… Ùˆ Ù„ÙˆØ¯ÛŒÙ†Ú¯
const body = document.body;
const themeToggle = document.getElementById('theme-toggle');
let currentTheme = localStorage.getItem('theme');
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

function applyTheme(theme) {
    if (theme === 'light') {
        body.classList.add('light-mode');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        document.querySelector('meta[name="theme-color"]').setAttribute('content', '#4a90e2');
    } else {
        body.classList.remove('light-mode');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffd700');
    }
}
if (!currentTheme) applyTheme(prefersDark.matches ? 'dark' : 'dark');
else applyTheme(currentTheme);

themeToggle.addEventListener('click', () => {
    const newTheme = body.classList.contains('light-mode') ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
    applyTheme(newTheme);
});

// Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù„ÙˆØ¯Ø±
window.addEventListener('load', () => {
    setTimeout(() => {
        document.getElementById('loading-overlay').classList.add('hidden');
    }, 500);
});

// 2. Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ
const hamburger = document.getElementById('hamburger');
const sideMenu = document.getElementById('side-menu');
const backdrop = document.getElementById('menu-backdrop');
const menuClose = document.getElementById('menu-close');

function openMenu() {
    sideMenu.classList.add('open');
    backdrop.classList.add('visible');
    hamburger.setAttribute('aria-expanded', 'true');
    sideMenu.setAttribute('aria-hidden', 'false');
}
function closeMenu() {
    sideMenu.classList.remove('open');
    backdrop.classList.remove('visible');
    hamburger.setAttribute('aria-expanded', 'false');
    sideMenu.setAttribute('aria-hidden', 'true');
}
hamburger.addEventListener('click', e => { e.stopPropagation(); hamburger.getAttribute('aria-expanded')==='true' ? closeMenu() : openMenu(); });
menuClose.addEventListener('click', e => { e.stopPropagation(); closeMenu(); });
backdrop.addEventListener('click', closeMenu);
sideMenu.addEventListener('click', e => e.stopPropagation());

// 3. Ù„ÙˆØ¯ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ (ØªÙ†Ù‡Ø§ Ø¨Ø®Ø´ÛŒ Ú©Ù‡ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ù…Ø§Ù†Ø¯Ù‡)
const container = document.getElementById("cards-container");
let openCard = null;

async function loadCardsStrictly() {
    for (let num = 1; num <= 50; num++) {
        try {
            const response = await fetch(`cards/${num}.html?v=${Date.now()}`, { cache: "no-store" });
            if (!response.ok) continue;
            const html = await response.text();
            const card = document.createElement("div");
            card.className = "movie-card";
            card.innerHTML = html;
            container.appendChild(card);
        } catch (e) { console.log("Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ Ú©Ø§Ø±Øª", num); }
    }
}
loadCardsStrictly();

// 4. Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ (Ø±Ø²Ø±Ùˆ Ùˆ Ú†Ø±Ø®Ø´)
document.addEventListener("click", function(e) {
    // Ø±Ø²Ø±Ùˆ
    const reserveBtn = e.target.closest(".reserve-bar a");
    if (reserveBtn && reserveBtn.textContent.trim() === "ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·") {
        e.preventDefault(); e.stopPropagation();
        const cardFront = reserveBtn.closest(".card-front");
        const adminId = cardFront.dataset.adminId || "softshirazadmin";
        const movieName = (cardFront.querySelector(".date-bar")?.textContent || "").trim();
        const dateTime = (cardFront.querySelector(".title-bar")?.textContent || "").trim();
        const hasDiscount = reserveBtn.closest(".card-inner").querySelector('.discount-label:not(.hidden)');
        const msg = `${hasDiscount ? "ğŸ‰ ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡! ğŸ‰\n\n" : ""}ğŸ’– Ø³Ù„Ø§Ù… ÙˆÙ‚Øª Ø¨Ø®ÛŒØ± ğŸ’–\n\nğŸ¬ ÙÛŒÙ„Ù… : ${movieName} ğŸ¿\nğŸ•“ Ø²Ù…Ø§Ù† : ${dateTime} â°\n\nâœ¨ Ø´Ø±Ø§ÛŒØ· Ø±Ø²Ø±Ùˆ Ù„Ø·ÙØ§ ğŸ™`;
        window.open(`https://t.me/${adminId}?text=${encodeURIComponent(msg)}`, "_blank");
        return;
    }
    // ÙÙ„ÛŒÙ¾
    const cardInner = e.target.closest(".card-inner");
    if (cardInner) {
        if (openCard && openCard !== cardInner) openCard.classList.remove("flipped");
        cardInner.classList.toggle("flipped");
        openCard = cardInner.classList.contains("flipped") ? cardInner : null;
    } else if (openCard && !e.target.closest(".reserve-bar")) {
        openCard.classList.remove("flipped");
        openCard = null;
    }
});

// 5. Ù†ØµØ¨ PWA
let deferredPrompt;
const installBtn = document.getElementById('install-button');
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'flex';
});
installBtn.addEventListener('click', async (e) => {
  e.stopPropagation();
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  deferredPrompt = null;
  installBtn.style.display = 'none';
});

// Ø«Ø¨Øª Ø³Ø±ÙˆÛŒØ³ ÙˆØ±Ú©Ø±
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/web/sw.js', { scope: '/web/' }).catch(console.error);
  });
}
</script>
</body>
</html>
