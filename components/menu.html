<style>
    #side-menu {
        position: fixed; top: 0; right: 0; height: 100vh; width: 320px; max-width: 85%;
        background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(20,20,20,0.98));
        box-shadow: 4px 0 30px rgba(0,0,0,0.6);
        transform: translateX(100%); transition: transform 0.32s cubic-bezier(.2,.9,.2,1);
        z-index: 30; padding: 28px; display: flex; flex-direction: column; gap: 18px;
        direction: rtl; border-right: 2px solid rgba(255,215,0,0.12);
    }
    #side-menu.open { transform: translateX(0); }
    .light-mode #side-menu {
        background: linear-gradient(180deg, rgba(248,251,255,0.98), rgba(240,245,255,0.98));
        border-right: 2px solid rgba(74,144,226,0.35);
    }
    .menu-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 20px; }
    .menu-controls { display: flex; gap: 8px; justify-content: space-between; width: 100%; }
    #menu-close, #theme-toggle {
        width: 44px; height: 44px; background: rgba(255,255,255,0.03);
        border: 2px solid rgba(255,255,255,0.03); border-radius: 12px;
        color: var(--color-primary); font-size: 24px; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: all 0.3s;
    }
    #menu-close:hover, #theme-toggle:hover {
        background: var(--color-primary); color: var(--bg-color); border-color: var(--color-primary);
    }
    .side-brand { font-weight:800; color:var(--color-primary); font-size:20px; margin: -10px 0 10px 0; text-align: center; }
    .side-links a {
        display:flex; align-items:center; justify-content:space-between; padding:12px 14px; 
        border-radius:10px; text-decoration:none; color:var(--text-color); font-weight:600;
        background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.03); transition: all 0.3s;
    }
    .side-links a:hover { background:rgba(255,215,0,0.06); color:var(--color-primary); }
    .menu-social-row { display: flex; justify-content: center; gap: 18px; margin-top: 12px; }
    .menu-install-icon, .menu-social-icon {
        width: 48px; height: 48px; border-radius: 12px; background:rgba(255,255,255,0.03);
        display: flex; align-items: center; justify-content: center;
        color: var(--color-primary); font-size: 22px; text-decoration: none; 
        transition: all 0.3s; cursor: pointer; border: 2px solid rgba(255,255,255,0.03);
    }
    .menu-install-icon:hover, .menu-social-icon:hover { background: rgba(255,215,0,0.06); border-color: var(--color-primary); }
    .side-footer-text { margin-top: auto; font-size: 13px; color: rgba(255,255,255,0.7); padding-top: 20px; text-align: center; }
    #menu-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.55); opacity:0; pointer-events:none; transition:opacity .28s; z-index:25; }
    #menu-backdrop.visible { opacity:1; pointer-events:auto; }
</style>

<div id="menu-backdrop" tabindex="-1"></div>
<nav id="side-menu" aria-hidden="true">
    <div class="menu-header">
        <div class="menu-controls">
            <button id="menu-close" aria-label="بستن منو"><i class="fas fa-times"></i></button>
            <button id="theme-toggle" aria-label="تغییر تم"><i class="fas fa-sun"></i></button>
        </div>
    </div>
    <div class="side-brand">ایونت‌های طلایی سافت شیراز</div>
    <div class="side-links" role="menu">
        <a href="../web/events/events.html" role="menuitem">ایونت‌های کتابخوانی</a>
        <a href="../web/room/room.html" role="menuitem">اتاقک</a>
        <a href="../web/about/about.html" role="menuitem">درباره ما</a>
    </div>
    <div class="menu-social-row">
        <div class="menu-install-icon" id="install-button" title="نصب اپ" style="display:none;"><i class="fas fa-download"></i></div>
        <a class="menu-social-icon" href="https://t.me/softshiraz" target="_blank"><i class="fab fa-telegram"></i></a>
        <a class="menu-social-icon" href="https://instagram.com/soft_shiraz" target="_blank"><i class="fab fa-instagram"></i></a>
        <a class="menu-social-icon" href="https://t.me/FLOKI000" target="_blank"><i class="fas fa-headset"></i></a>
    </div>
    <div class="side-footer-text">ساخته شده توسط فلوکی</div>
</nav>

<script>
    // مدیریت منو و تم
    (function() {
        const sideMenu = document.getElementById('side-menu');
        const backdrop = document.getElementById('menu-backdrop');
        const closeBtn = document.getElementById('menu-close');
        const themeToggle = document.getElementById('theme-toggle');
        const hamburger = document.getElementById('hamburger'); // دکمه هدر

        function openMenu() {
            sideMenu.classList.add('open');
            backdrop.classList.add('visible');
            sideMenu.setAttribute('aria-hidden', 'false');
            if(hamburger) hamburger.setAttribute('aria-expanded', 'true');
        }
        function closeMenu() {
            sideMenu.classList.remove('open');
            backdrop.classList.remove('visible');
            sideMenu.setAttribute('aria-hidden', 'true');
            if(hamburger) hamburger.setAttribute('aria-expanded', 'false');
        }

        // شنونده رویداد از سمت هدر
        window.addEventListener('toggleMenuRequest', () => {
             sideMenu.classList.contains('open') ? closeMenu() : openMenu();
        });

        closeBtn.addEventListener('click', closeMenu);
        backdrop.addEventListener('click', closeMenu);
        sideMenu.addEventListener('click', e => e.stopPropagation());

        // تم
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
        let currentTheme = localStorage.getItem('theme');
        function applyTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add('light-mode');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                document.querySelector('meta[name="theme-color"]').setAttribute('content', '#4a90e2');
                currentTheme = 'light';
            } else {
                document.body.classList.remove('light-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffd700');
                currentTheme = 'dark';
            }
        }
        if(!currentTheme) applyTheme(prefersDark.matches ? 'dark' : 'dark');
        else applyTheme(currentTheme);

        themeToggle.addEventListener('click', () => {
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        });

        // PWA Install
        let deferredPrompt;
        const installBtn = document.getElementById('install-button');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault(); deferredPrompt = e; installBtn.style.display = 'flex';
        });
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });
    })();
</script>
