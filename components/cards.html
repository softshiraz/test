<style>
    .movies-grid {
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        justify-items: center; max-width: 1200px; margin: 0 auto; padding: 0 20px; margin-bottom: 45px;
    }
    .movie-card { perspective:1000px; position: relative; }
    .card-inner {
        position:relative; width:280px; height:420px; cursor:pointer;
        transition:transform 0.65s cubic-bezier(0.5, 1.25, 0.5, 1.25);
        transform-style:preserve-3d;
    }
    .card-inner.flipped { transform:rotateY(180deg); }
    .card-front, .card-back {
        position:absolute; top:0; left:0; width:100%; height:100%; border-radius:16px; overflow:hidden;
        backface-visibility:hidden; border:2px solid var(--color-primary); /* Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ */
        box-shadow:0 0 8px var(--glow-color), inset 0 0 6px var(--glow-color);
        background: rgba(19,19,20,0.75); backdrop-filter:blur(10px);
    }
    .light-mode .card-front, .light-mode .card-back { background: rgba(255,255,255,0.92); border-color: rgba(74,144,226,0.55); }
    
    .card-front { display:flex; flex-direction:column; }
    .img-bar { flex:1; overflow:hidden; }
    .img-bar img { width:100%; height:100%; object-fit:cover; }
    
    .date-bar {
        height:52px; line-height:52px; padding:0 10px; text-align:center;
        background: rgba(255,215,0,0.12); color: var(--accent-text);
        font-size:19px; font-weight:900; text-shadow:0 0 14px var(--glow-color);
    }
    .light-mode .date-bar { background: rgba(74,144,226,0.25); }
    
    .title-bar {
        height:36px; line-height:36px; padding:0 10px; text-align:center;
        background: rgba(255,255,255,0.03); border-top:1px solid rgba(255,255,255,0.03);
        color:var(--text-color); font-weight:600; font-size:15px;
    }
    .reserve-bar {
        height:36px; line-height:36px; padding:0 10px; text-align:center;
        background:var(--color-primary); color:var(--bg-color); font-weight:bold; 
        cursor:pointer; transition:background 0.3s;
    }
    .reserve-bar:hover { background:#ffea00; }
    
    .card-back {
        transform:rotateY(180deg); padding:15px; color:var(--text-color); text-align:right;
        font-size:14px; display:flex; flex-direction:column;
    }
    .card-back h3, .card-back p strong { color:var(--color-primary); }
    
    .discount-label {
        position: absolute; top: 0; right: 0;
        background: linear-gradient(135deg, #c084fc, #f472b6);
        color: white; font-weight: bold; font-size: 13px; padding: 6px 12px;
        border-radius: 0 0 0 12px; z-index: 10; animation: pulse 2s infinite;
    }
    .discount-label.hidden { display: none; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    
    @media (max-width:1200px) { .movies-grid { grid-template-columns:repeat(3,1fr); } }
    @media (max-width:768px) { .movies-grid { grid-template-columns:repeat(2,1fr); } }
    @media (max-width:480px) { .movies-grid { grid-template-columns:1fr; } }
</style>

<div class="movies-grid" id="cards-container"></div>

<script>
    (async function() {
        const container = document.getElementById("cards-container");
        let openCard = null;

        // Ù„ÙˆØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
        async function loadCards() {
            for (let num = 1; num <= 50; num++) {
                try {
                    const response = await fetch(`cards/${num}.html?v=${Date.now()}`);
                    if (!response.ok) continue;
                    const html = await response.text();
                    const card = document.createElement("div");
                    card.className = "movie-card";
                    card.innerHTML = html;
                    container.appendChild(card);
                } catch (e) {}
            }
        }
        await loadCards();

        // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú©Ù„ÛŒÚ© (ÙÙ„ÛŒÙ¾ Ùˆ Ø±Ø²Ø±Ùˆ)
        container.addEventListener("click", function(e) {
            // Ø±Ø²Ø±Ùˆ Ø¨Ù„ÛŒØ·
            const reserveBtn = e.target.closest(".reserve-bar a");
            if (reserveBtn && reserveBtn.textContent.trim() === "ØªÙ‡ÛŒÙ‡ Ø¨Ù„ÛŒØ·") {
                e.preventDefault(); e.stopPropagation();
                
                const cardFront = reserveBtn.closest(".card-front");
                const adminId = cardFront.dataset.adminId || "softshirazadmin";
                const movieName = (cardFront.querySelector(".date-bar")?.textContent || "").trim();
                const dateTime = (cardFront.querySelector(".title-bar")?.textContent || "").trim();
                const hasDiscount = reserveBtn.closest(".card-inner").querySelector('.discount-label:not(.hidden)');
                
                const msg = `${hasDiscount ? "ðŸŽ‰ ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡! ðŸŽ‰\n\n" : ""}ðŸ’– Ø³Ù„Ø§Ù… ÙˆÙ‚Øª Ø¨Ø®ÛŒØ± ðŸ’–\n\nðŸŽ¬ ÙÛŒÙ„Ù… : ${movieName} ðŸ¿\nðŸ•“ Ø²Ù…Ø§Ù† : ${dateTime} â°\n\nâœ¨ Ø´Ø±Ø§ÛŒØ· Ø±Ø²Ø±Ùˆ Ù„Ø·ÙØ§ ðŸ™`;
                window.open(`https://t.me/${adminId}?text=${encodeURIComponent(msg)}`, "_blank");
                return;
            }

            // ÙÙ„ÛŒÙ¾ Ú©Ø§Ø±Øª
            const cardInner = e.target.closest(".card-inner");
            if (cardInner) {
                if (openCard && openCard !== cardInner) openCard.classList.remove("flipped");
                cardInner.classList.toggle("flipped");
                openCard = cardInner.classList.contains("flipped") ? cardInner : null;
            } else if (openCard) {
                openCard.classList.remove("flipped");
                openCard = null;
            }
        });
        
        // Ø¨Ø³ØªÙ† Ú©Ø§Ø±Øª Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨ÛŒØ±ÙˆÙ†
        document.addEventListener("click", (e) => {
            if (!e.target.closest(".card-inner") && openCard) {
                openCard.classList.remove("flipped");
                openCard = null;
            }
        });
    })();
</script>
